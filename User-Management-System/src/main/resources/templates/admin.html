<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #005f86;
            color: white;
        }
        .container {
            background-color: white;
            color: black;
            padding: 20px;
            border-radius: 10px;
            max-width: 800px;
            margin: auto;
            margin-top: 50px;
        }
        .admin-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #d63384;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .admin-btn:hover {
            background-color: #c2185b;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 50%;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .button-group {
            display: flex;
            justify-content: space-between;
        }
        .btn {
            padding: 10px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            width: 48%;
        }
        .btn-primary {
            background-color: #d63384;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center">Admin List</h2>

    <!-- Search and Sort -->
    <form class="d-flex justify-content-between mb-3">
        <input type="text" id="searchInput" class="form-control w-50" placeholder="Search Admin">
        <div class="d-flex align-items-center">
            <label for="sortBy" class="me-2">Sort By:</label>
            <select id="sortBy" class="form-select w-25 me-2">
                <option value="name">Name</option>
                <option value="email">Email</option>
            </select>
            <select id="sortOrder" class="form-select w-25">
                <option value="asc">Asc</option>
                <option value="desc">Desc</option>
            </select>
            <button type="button" class="btn btn-primary" onclick="searchAdmins()">Search</button>
        </div>
    </form>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>ID</th>
            <th>Admin Name</th>
            <th>Email</th>
            <th>Password</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody id="adminTable">
        <tr th:each="user : ${users}">
            <td th:text="${user.uniqueId}"></td>
            <td th:text="${user.userName}"></td>
            <td th:text="${user.email}"></td>
            <td th:text="${user.password}"></td>
            <td>
                <button class="btn btn-danger btn-sm">Delete</button>
                <button class="btn btn-primary"
                        th:attr="onclick=|openUpdateModal('${user.uniqueId}', '${user.userName}', '${user.email}', '${user.password}')|">
                    Update
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Update Admin Modal -->
    <div id="updateAdminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUpdateModal()">&times;</span>
            <h2>Update Admin</h2>
            <form id="updateAdminForm">
                <label for="adminId">Admin ID:</label>
                <input type="text" id="adminId" name="adminId" readonly>

                <label for="username">Admin Name:</label>
                <input type="text" id="username" name="username">

                <label for="email">Email:</label>
                <input type="email" id="email" name="email">

                <label for="password">Password:</label>
                <input type="text" id="password" name="password">

                <label for="role">Role:</label>
                <input type="text" id="role" name="role" value="Admin" readonly>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="closeUpdateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="updateButton">Update Admin</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Admin Modal -->
    <div id="createAdminModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCreateModal()">&times;</span>
            <h2>Create New Admin</h2>
            <form id="createAdminForm">
                <label for="newUsername">Admin Name:</label>
                <input type="text" id="newUsername" name="username" required>

                <label for="newEmail">Email:</label>
                <input type="email" id="newEmail" name="email" required>

                <label for="newPassword">Password:</label>
                <input type="password" id="newPassword" name="password" required>

                <label for="newRole">Role:</label>
                <input type="text" id="newRole" name="role" value="Admin" readonly>

                <div class="button-group">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="createButton">Create Admin</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Pagination -->
    <nav>
        <ul class="pagination justify-content-center">
            <li th:if="${currentPage > 0}" class="page-item">
                <a class="page-link" th:href="@{/admin(page=${currentPage - 1})}">Previous</a>
            </li>

            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}" class="page-item">
                <a class="page-link" th:href="@{/admin(page=${i})}" th:text="${i + 1}"></a>
            </li>

            <li th:if="${currentPage < totalPages - 1}" class="page-item">
                <a class="page-link" th:href="@{/admin(page=${currentPage + 1})}">Next</a>
            </li>
        </ul>
    </nav>

</div>

<!-- Create Admin Button -->
<button class="admin-btn" onclick="openCreateModal()">Create Admin</button>

<script>
    function searchAdmins() {
    let sortBy ;
    if(document.getElementById("sortBy").value==Name){
      sortBy = userName;
    }
    else if(document.getElementById("sortBy").value==Id){
    sortBy = uniqueId;
    }
    else{
    sortBy = email;
    }

    const searchValue = document.getElementById("searchInput").value;
    const sortOrder = document.getElementById("sortOrder").value;


    // Redirect with the role filter applied
    window.location.href = `/admin?userName=${searchValue}&field=${sortBy}&order=${sortOrder}`;
}

    function openUpdateModal(id, name, email, password) {
        document.getElementById('adminId').value = id;
        document.getElementById('username').value = name;
        document.getElementById('email').value = email;
        document.getElementById('password').value = password;

        document.getElementById('updateAdminModal').style.display = 'block';
    }
    document.getElementById("updateAdminForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent default form submission

    // Collect data from form fields
    const adminId = document.getElementById("adminId").value;
    const username = document.getElementById("username").value;
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    // Prepare data object
    const adminData = {
        uniqueId: adminId,
        userName: username,
        email: email,
        password: password,
        role:"ADMIN"
    };

    // Send data to backend using fetch API
    fetch(`/api/users`, {
        method: "POST",  // Use PUT or POST depending on your backend setup
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(adminData)
    })
    .then(response => response.json())
    .then(data => {
        alert("Admin updated successfully!");
        location.reload(); // Reload page to reflect changes
    })
    .catch(error => console.error("Error updating admin:", error));
});

    function closeUpdateModal() {
        document.getElementById('updateAdminModal').style.display = 'none';
    }


    // Open Create Modal
function openCreateModal() {
    document.getElementById("createAdminModal").style.display = "block";
}

// Close Create Modal
function closeCreateModal() {
    document.getElementById("createAdminModal").style.display = "none";
}

document.getElementById("createAdminForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Prevent default form submission

    // Get form values
    const userData = {
        userName: document.getElementById("newUsername").value,
        email: document.getElementById("newEmail").value,
        password: document.getElementById("newPassword").value,
        role: document.getElementById("newRole").value
    };

    // Send JSON data using fetch
    fetch("/api/users", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(userData)
    })
    .then(response => response.json())
    .then(data => {
        alert(data.message || "Admin created successfully!");
        closeCreateModal();
        window.location.reload(); // Reload admin list page
    })
    .catch(error => console.error("Error:", error));
});


</script>

</body>
</html>
